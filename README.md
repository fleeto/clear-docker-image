# Clear docker images

Usage: `clear.py sql_id if_hash_only action`

- **sql_id**: It's conditions will be used to filter the images.
- **hash_only**: 0 or 1. it will show only hash of images if `hash_only==1`.
- **action**: If its value is "none", the command will display image list
generated by the sql. if it set to be others, such as "delete", "docker delete [hash]" will be executed.

## Data Structure

The script will store image info into a in-memory sqlite database.

~~~sql

CREATE TABLE images (id INTEGER PRIMARY KEY,image_id TEXT,
  image_name TEXT, image_tag TEXT, created INTEGER,
  image_size INTEGER);")

~~~

We can store conditons in `conf.json`, to get get image list that match the filter.

for example:

~~~json
  "sql": {
    "none": "image_name = '<none>'"
  }

~~~

## Examples

### RMI all images named `<none>`

**in 'conf.json'**:

~~~json
  "sql": {
    "none": "image_name = '<none>'"
  }
~~~

**command line**

`clear.py none 1 rmi`

### RMI all images named like '%prod%', except for tag 'latest'

**in 'conf.json'**:

~~~json
  "sql": {
    "autobuild": "image_name like '%prod%' and image_tag != 'latest'"
  }
~~~

**command line**

`clear.py autobuild 1 rmi`

# 清除 Docker 镜像

命令格式 `clear.py sql_id if_hash_only action`

- **sql_id**：过滤条件，用于筛选操作镜像列表。
- **hash_only**：是否仅显示哈希值，取值范围 0 | 1。
- **action**：对查询结果的操作，如果是 `none`，则只显示过滤镜像结果。如果设置为其他值，则会根据配置文件执行动作。

## 数据结构

脚本执行过程中，会把本地 Docker 镜像的信息保存在内存中的 sqlite 数据库中。

~~~sql

CREATE TABLE images (id INTEGER PRIMARY KEY,image_id TEXT,
  image_name TEXT, image_tag TEXT, created INTEGER,
  image_size INTEGER);")

~~~

把 SQL 的查询条件保存在 `conf.json` 中，以其 id 进行查询，就能够直接使用这一条件对镜像进行过滤。

例如：

~~~json
  "sql": {
    "none": "image_name = '<none>'"
  }

~~~

## 示例

### 删除所有名为 `<none>` 的镜像

**'conf.json'**:

~~~json
  "sql": {
    "none": "image_name = '<none>'"
  }
~~~

**命令行**

`clear.py none 1 rmi`

### 删除所有镜像名称类似 `%prod%` 且 Tag 不是 `latest` 的镜像

**'conf.json'**:

~~~json
  "sql": {
    "autobuild": "image_name like '%prod%' and image_tag != 'latest'"
  }
~~~

**命令行**

`clear.py autobuild 1 rmi`
